# Rich Rich Daifugo - 実装済みローカルルール一覧

本ドキュメントは、Rich Rich Daifugo（大富豪バカゲー）で実装されているすべてのローカルルールを詳細に説明します。

## 目次

0. 要修正項目
1. [場をクリアするルール](#1-場をクリアするルール)
2. [革命バリエーション](#2-革命バリエーション)
3. [特殊勝利条件](#3-特殊勝利条件)
4. [カード強度ルール](#4-カード強度ルール)
5. [フィールド効果](#5-フィールド効果)
6. [ターン操作](#6-ターン操作)
7. [特殊効果](#7-特殊効果)
8. [実装状況サマリー](#8-実装状況サマリー)

---

## 0. 要修正項目

修正が必要です：

- 捨てたカードが画面から消えない
- 5 が出ている状態でなぜか 4 と 6 が両方出せる
- 10捨て: なぜか 10 以下のカードを捨てられない。

## 1. 場をクリアするルール

これらのルールは場にあるカードをすべてクリアし、出したプレイヤーが次の手番も続けて行うことができます。

### 8切り (Eight-Cut)

**発動条件**: 8のカードが出されたとき（枚数不問）

**効果**:

- 場がクリアされる
- 出したプレイヤーが次の手番も行う
- 8切りは4止めで止められる（後述）

**プレイ例**:

```
場: 5♠
プレイヤーA: 8♦を出す → 8切り発動！
場: （クリア）
プレイヤーA: 引き続きプレイ（任意のカードを出せる）
```

**実装状態**: ✅ 完全実装・テスト済み

---

### 救急車 (Ambulance / 9x2)

**発動条件**: 9のペア（2枚）が出されたとき

**効果**:

- 場がクリアされる
- 出したプレイヤーが次の手番も行う

**プレイ例**:

```
場: 7♠ 7♦
プレイヤーB: 9♠ 9♥を出す → 救急車発動！
場: （クリア）
プレイヤーB: 引き続きプレイ
```

**実装状態**: ✅ 完全実装・テスト済み

---

### ろくろ首 (Rokurokubi / 6x2)

**発動条件**: 6のペア（2枚）が出されたとき

**効果**:

- 場がクリアされる
- 出したプレイヤーが次の手番も行う

**プレイ例**:

```
場: 5♠ 5♦
プレイヤーC: 6♣ 6♥を出す → ろくろ首発動！
場: （クリア）
プレイヤーC: 引き続きプレイ
```

**実装状態**: ✅ 完全実装・テスト済み

---

## 2. 革命バリエーション

革命はカードの強さ判定を逆転させるルールです。通常は 2 > A > K > ... > 3 ですが、革命時は 3 > 4 > 5 > ... > A > 2 となります。

### 通常革命 (Normal Revolution)

**発動条件**: 同じランクのカード4枚（フォーカード）が出されたとき

**効果**:

- カードの強さ判定が逆転（または元に戻る）
- `isRevolution`フラグが反転

**プレイ例**:

```
場: （空）
プレイヤーA: 5♠ 5♥ 5♦ 5♣を出す → 革命発動！
強さ: 3 > 4 > 5 > 6 > ... > K > A > 2 に変化
```

**11バックとの相互作用**: XORロジック（どちらか一方のみ有効なら反転）

**実装状態**: ✅ 完全実装・テスト済み

---

### エンペラー (Emperor)

**発動条件**: 4種類のマークの連番（階段）

**効果**: 革命と同じ（強さ判定が逆転）

**既知の問題**: ⚠️ 設計上の矛盾

- 階段は同じマークである必要があるため、4種マーク連番は出すことができない
- 実装はされているが、実際には発動しない

**実装状態**: ⚠️ 部分実装（設計要見直し）

---

### クーデター (Coup / 9x3)

**発動条件**: 9のスリーカード（3枚）が出されたとき

**効果**: 革命と同じ（強さ判定が逆転）

**プレイ例**:

```
場: （空）
プレイヤーB: 9♠ 9♥ 9♦を出す → クーデター発動！
強さが逆転
```

**実装状態**: ✅ 完全実装・テスト済み

---

### オーメン (Omen / 6x3)

**発動条件**: 6のスリーカード（3枚）が出されたとき

**効果**:

- 革命と同じ（強さ判定が逆転）
- 「以後革命なし」フラグが立つ
- オーメン発動後は通常革命が発動しなくなる

**プレイ例**:

```
場: （空）
プレイヤーC: 6♠ 6♥ 6♦を出す → オーメン発動！
強さが逆転し、以後フォーカードを出しても革命は発動しない
```

**実装状態**: ✅ 完全実装・テスト済み

---

### 大革命 (Great Revolution / 2x4)

**発動条件**: 2のフォーカード（4枚）が出されたとき

**効果**:

- 革命と同じ（強さ判定が逆転）
- 出したプレイヤーが**即座に上がる**（残りの手札を全て捨てる）

**既知の問題**: ⚠️

- 2のフォーカードは通常革命も同時にトリガーするため、2つの革命が相殺される
- 結果的に強さが元に戻ってしまう

**プレイ例**:

```
プレイヤーD: 2♠ 2♥ 2♦ 2♣を出す → 大革命発動！
→ 同時に通常革命も発動 → 相殺される（バグ）
プレイヤーD: 即座に上がる
```

**実装状態**: ✅ 実装済みだが既知バグあり

---

## 3. 特殊勝利条件

### 禁止上がり (Forbidden Finish)

**発動条件**: J、2、8、Jokerのいずれかで手札が0枚になる（上がろうとする）とき

**効果**:

- 上がることができない
- 出したカードが手札に戻る
- 場がクリアされる

**プレイ例**:

```
プレイヤーA: 手札 J♠（最後の1枚）
プレイヤーA: J♠を出す → 禁止上がり！
J♠が手札に戻り、場がクリアされる
```

**実装状態**: ✅ 完全実装・テスト済み

---

## 4. カード強度ルール

### 砂嵐 (Sandstorm / 3x3)

**発動条件**: 3のスリーカード（3枚）が出されたとき

**効果**:

- 何にでも勝つ（場に何があっても出せる）
- 場に砂嵐がある場合、砂嵐以外では対抗できない

**プレイ例**:

```
場: 2♠ 2♥ 2♦（最強のスリーカード）
プレイヤーA: 3♠ 3♥ 3♦を出す → 砂嵐発動！勝てる
```

**実装状態**: ✅ 完全実装・テスト済み

---

### スペード3返し (Spade Three Return)

**発動条件**: 場にJoker（単一カード）がある状態で、スペードの3（単一カード）が出されたとき

**効果**: スペードの3がJokerに勝つ

**プレイ例**:

```
場: Joker
プレイヤーB: 3♠を出す → スペード3返し！勝てる
```

**実装状態**: ✅ 完全実装・テスト済み

---

### ダウンナンバー (Down Number)

**発動条件**: 場と同じマークで、1つ下のランクのカード（単一カード）が出されたとき

**効果**: 強さ判定をスキップして出すことができる

**プレイ例**:

```
場: 5♥（単一カード）
プレイヤーC: 4♥を出す → ダウンナンバー！勝てる
```

**注意**:

- 単一カード同士のみ
- 同じマーク必須
- 1つ下のランクのみ（2つ下は不可）

**実装状態**: ✅ 完全実装・テスト済み

---

## 5. フィールド効果

### マークしばり (Suit Lock)

**発動条件**: 同じマークのプレイが2回連続で出されたとき

**効果**:

- 次のプレイヤーから、指定されたマークのカードのみ出せる
- 場がクリアされるまで継続

**プレイ例**:

```
1回目: プレイヤーA: 5♠を出す
2回目: プレイヤーB: 7♠を出す → マークしばり発動！（スペード縛り）
以降: スペードのカードのみ出せる
```

**解除条件**: 場がクリア（8切りなど）されると解除

**実装状態**: ✅ 完全実装・テスト済み

---

### 数字しばり (Number Lock)

**発動条件**: 階段（連番）が2回連続で出されたとき

**効果**:

- 次のプレイヤーから、階段のみ出せる
- 場がクリアされるまで継続

**プレイ例**:

```
1回目: プレイヤーA: 3♠ 4♠ 5♠を出す（階段）
2回目: プレイヤーB: 4♥ 5♥ 6♥を出す（階段） → 数字しばり発動！
以降: 階段のみ出せる
```

**解除条件**: 場がクリアされると解除

**実装状態**: ✅ 完全実装・テスト済み

---

### 4止め (Four Stop)

**発動条件**: 8切り発動後（`isEightCutPending`フラグが立っている状態）に、4のペア（2枚）が出されたとき

**効果**: 8切りを止める（場がクリアされない）

**既知の問題**: ⚠️

- 8を出した時点で即座に場がクリアされるため、4止めを出す機会がない
- 実装はされているが、実際には機能しない

**プレイ例**（想定動作）:

```
プレイヤーA: 8♠を出す → 8切り予約
プレイヤーB: 4♥ 4♦を出す → 4止め発動！8切りがキャンセル
場: 8♠（クリアされない）
```

**実装状態**: ⚠️ 実装済みだが既知バグあり

---

## 6. ターン操作

### 5スキップ (Five Skip)

**発動条件**: 5のカードが出されたとき（枚数不問）

**効果**: 次のプレイヤーが1人スキップされる（2人分進む）

**プレイ例**:

```
ターン順: A → B → C → D
プレイヤーA: 5♠を出す → 5スキップ発動！
次のターン: プレイヤーC（Bがスキップされた）
```

**実装状態**: ✅ 完全実装・テスト済み

---

### 9リバース (Nine Reverse)

**発動条件**: 9のカードが出されたとき（枚数不問）

**効果**: ターン順が逆転（時計回り ⇄ 反時計回り）

**プレイ例**:

```
ターン順: A → B → C → D（時計回り）
プレイヤーA: 9♠を出す → 9リバース発動！
ターン順: A → D → C → B（反時計回り）
```

**実装状態**: ✅ 完全実装・テスト済み

---

### 7渡し (Seven Pass)

**発動条件**: 7のカードが出されたとき（枚数不問）

**効果**:

- 出したプレイヤーが手札から1枚を選択
- 選択したカードを次のプレイヤーに渡す

**プレイ例**:

```
プレイヤーA: 7♠を出す → 7渡し発動！
システム: プレイヤーAに「次のプレイヤー（B）に渡すカードを選んでください」とプロンプト
プレイヤーA: 2♦を選択
プレイヤーB: 2♦を受け取る
```

**ユーザー選択機能**: ✅ 実装済み

- 人間プレイヤー: UIで選択
- CPUプレイヤー: ランダムに選択

**実装状態**: ✅ 完全実装・テスト済み

---

### 10捨て (Ten Discard)

**発動条件**: 10のカードが出されたとき（枚数不問）

**効果**:

- 出したプレイヤーが手札から1枚を選択
- 選択したカードを捨てる（ゲームから除外）

**プレイ例**:

```
プレイヤーB: 10♥を出す → 10捨て発動！
システム: プレイヤーBに「捨てるカードを選んでください」とプロンプト
プレイヤーB: A♠を選択
A♠が捨てられる（ゲームから除外）
```

**ユーザー選択機能**: ✅ 実装済み

- 人間プレイヤー: UIで選択
- CPUプレイヤー: ランダムに選択

**実装状態**: ✅ 完全実装・テスト済み

---

## 7. 特殊効果

### 11バック (Eleven Back)

**発動条件**: Jのカードが出されたとき（枚数不問）

**効果**:

- カードの強さ判定が逆転（または元に戻る）
- `isElevenBack`フラグが反転

**革命との相互作用（XORロジック）**:
| 革命 | 11バック | 結果 |
|------|----------|------|
| OFF | OFF | 通常 |
| OFF | ON | 反転 |
| ON | OFF | 反転 |
| ON | ON | 通常（キャンセル） |

**プレイ例**:

```
通常状態
プレイヤーA: J♠を出す → 11バック発動！
強さ: 3 > 4 > 5 > ... > A > 2 に変化

革命中
プレイヤーB: J♥を出す → 11バック発動！
強さ: 3 < 4 < 5 < ... < A < 2 に戻る（XORでキャンセル）
```

**実装状態**: ✅ 完全実装・テスト済み

---

### クイーンボンバー (Queen Bomber)

**発動条件**: Qのカードが出されたとき（枚数不問）

**効果**:

1. 出したプレイヤーが任意のランクを指定（3～2、Joker除く）
2. 次のプレイヤーから時計回りに、全員が指定されたランクのカードを持っていれば捨てる
3. 持っていない場合はスキップ

**プレイ例**:

```
プレイヤーA: Q♠を出す → クイーンボンバー発動！
システム: プレイヤーAに「全員が捨てるランクを選んでください」とプロンプト
プレイヤーA: 「5」を選択

プレイヤーB: 5♥を持っている → 5♥を捨てる
プレイヤーC: 5を持っていない → スキップ
プレイヤーD: 5♦を持っている → 5♦を捨てる
プレイヤーA: 5♠を持っている → 5♠を捨てる
```

**ユーザー選択機能**: ✅ 実装済み（2段階選択）

- 段階1（queenBomberSelect）: 発動プレイヤーがランク選択
  - 人間: 全13ランクのボタンから選択
  - CPU: ランダムに選択
- 段階2（queenBomber）: 各プレイヤーが指定カードを捨てる
  - 人間: 持っていれば自動選択、なければ「手札にない」ボタン
  - CPU: 持っていれば自動で捨てる

**実装状態**: ✅ 完全実装・テスト済み

---

## 8. 実装状況サマリー

### 完全実装済み（21ルール）

| #   | ルール名         | カテゴリ   | 特記事項                      |
| --- | ---------------- | ---------- | ----------------------------- |
| 1   | 8切り            | 場クリア   | -                             |
| 2   | 救急車           | 場クリア   | 9のペア                       |
| 3   | ろくろ首         | 場クリア   | 6のペア                       |
| 4   | 通常革命         | 革命       | 4枚出し                       |
| 5   | クーデター       | 革命       | 9のスリーカード               |
| 6   | オーメン         | 革命       | 6のスリーカード、以後革命なし |
| 7   | 禁止上がり       | 勝利条件   | J/2/8/Jokerで上がれない       |
| 8   | 砂嵐             | カード強度 | 3のスリーカード               |
| 9   | スペード3返し    | カード強度 | スペード3 > Joker             |
| 10  | ダウンナンバー   | カード強度 | 同マーク1つ下                 |
| 11  | マークしばり     | フィールド | 同マーク2連続                 |
| 12  | 数字しばり       | フィールド | 階段2連続                     |
| 13  | 5スキップ        | ターン     | 次の人をスキップ              |
| 14  | 9リバース        | ターン     | 順番逆転                      |
| 15  | 7渡し            | ターン     | ユーザー選択機能              |
| 16  | 10捨て           | ターン     | ユーザー選択機能              |
| 17  | 11バック         | 特殊       | 強さ反転、革命とXOR           |
| 18  | クイーンボンバー | 特殊       | ユーザー選択機能（2段階）     |

### 実装済みだが既知バグあり（2ルール）

| #   | ルール名 | 問題                  | 影響                  |
| --- | -------- | --------------------- | --------------------- |
| 1   | 大革命   | 通常革命と相殺される  | 強さが元に戻る        |
| 2   | 4止め    | 8が即座にクリアされる | 4止めを出す機会がない |

### 部分実装（設計要見直し）（1ルール）

| #   | ルール名   | 問題                                            |
| --- | ---------- | ----------------------------------------------- |
| 1   | エンペラー | 階段は同マーク必須のため、4種マーク連番は不可能 |

### 未実装（4ルール）

これらはゲーム終了後のルールで、現在未実装です：

1. 都落ち (City Fall)
2. 下剋上 (Gekokujou)
3. ラッキーセブン (Lucky Seven)
4. 天変地異 (Catastrophe)

---

## 9. カードの基本仕様

### カード強度

```
3=1, 4=2, 5=3, 6=4, 7=5, 8=6, 9=7, 10=8,
J=9, Q=10, K=11, A=12, 2=13, JOKER=14
```

通常: 3 < 4 < 5 < ... < A < 2 < Joker
革命: 3 > 4 > 5 > ... > A > 2 > Joker

### プレイタイプ

- **SINGLE**: 単一カード
- **PAIR**: ペア（2枚）
- **TRIPLE**: スリーカード（3枚）
- **QUAD**: フォーカード（4枚）
- **STAIR**: 階段（同じマークの連番、3枚以上）

---

## 10. ゲーム状態フィールド

以下のフィールドでルールの状態を管理しています：

```typescript
interface GameState {
  isRevolution: boolean; // 革命状態
  isElevenBack: boolean; // 11バック状態
  isOmenActive: boolean; // オーメン発動済み
  isEightCutPending: boolean; // 8切り予約状態
  suitLock: string | null; // マークしばり（スート名）
  numberLock: boolean; // 数字しばり
  isReversed: boolean; // ターン順逆転
  cardSelectionRequest: CardSelectionRequest | null; // ユーザー選択リクエスト
}
```

---

## まとめ

**実装済みルール**: 21ルール
**既知バグあり**: 2ルール
**部分実装**: 1ルール
**未実装**: 4ルール
**合計**: 28ルール定義

すべてのルールは同時に有効化される前提で設計されており、複雑な相互作用を楽しむ「カオスバカゲー」を実現しています。
